<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Stingray Supplier Portal</title>

<style>
/* ================= THEME TOKENS ================= */
:root{
  /* LIGHT (default) */
  --brand:#002C73;            /* light mode primary */
  --accent:#2F6DFF;           /* UI accent */
  --page-bg:#ffffff;
  --surface:#ffffff;

  --text:#0b1220;
  --text-muted: rgba(11,18,32,0.72);

  --on-dark:#ffffff;          /* text on dark overlays */
  --on-dark-muted: rgba(255,255,255,0.78);

  --glass: rgba(255,255,255,0.14);
  --glass-strong: rgba(255,255,255,0.18);

  --hero-fade: rgba(0,0,0,0.42); /* ✅ black fade over carousel */

  /* ✅ Brand gradients */
  --brand-gradient: linear-gradient(135deg,
    color-mix(in srgb, var(--brand) 92%, #0B4AA6 8%) 0%,
    color-mix(in srgb, var(--brand) 70%, #2F6DFF 30%) 48%,
    color-mix(in srgb, var(--brand) 92%, #0B4AA6 8%) 100%);
}

/* DARK */
body[data-theme="dark"]{
  --brand:#F78D29;            /* dark mode primary (orange) */
  --accent:#F78D29;
  --page-bg:#000000;
  --surface:#000000;

  --text:#ffffff;
  --text-muted: rgba(255,255,255,0.72);

  --glass: rgba(0,0,0,0.46);
  --glass-strong: rgba(0,0,0,0.58);

  --hero-fade: rgba(0,0,0,0.46); /* ✅ still black fade */

  /* ✅ Brand gradients */
  --brand-gradient: linear-gradient(135deg,
    color-mix(in srgb, var(--brand) 92%, #FFB15A 8%) 0%,
    color-mix(in srgb, var(--brand) 70%, #FF9B2F 30%) 48%,
    color-mix(in srgb, var(--brand) 92%, #FFB15A 8%) 100%);
}

*{ box-sizing:border-box; }

html, body{
  margin:0;
  height:100%;
  font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
  background: var(--page-bg);
  color: var(--text);
}

/* Dedicated scroll container for SharePoint embed */
.portal-shell{
  height: 100vh;
  width: 100%;
  overflow-y: auto;
  overflow-x: hidden;
  background: var(--page-bg);
  scroll-behavior: smooth;
  position: relative;
}

/* ================= TOP PROGRESS NAV ================= */

.progress{
  position: sticky;
  top: 0;
  z-index: 50;
  pointer-events: none;
}

.progress.is-hidden{
  opacity: 0;
  transform: translateY(-10px);
  transition: opacity 220ms ease, transform 220ms cubic-bezier(.2,.9,.2,1);
}

.progress.is-visible{
  opacity: 1;
  transform: translateY(0);
  transition: opacity 220ms ease, transform 220ms cubic-bezier(.2,.9,.2,1);
}

.progress-inner{
  width: 100%;
  height: 6px;
  background: rgba(0,0,0,0.08);
}
body[data-theme="dark"] .progress-inner{
  background: rgba(255,255,255,0.10);
}

.progress-bar{
  height: 100%;
  width: 0%;
  background: color-mix(in srgb, var(--accent) 95%, transparent);
  transform-origin: left center;
}

.progress-labels{
  display:flex;
  gap: 10px;
  padding: 10px 14px;
  justify-content:center;
  flex-wrap: wrap;
  background: color-mix(in srgb, var(--surface) 88%, transparent);
  backdrop-filter: blur(10px);
  border-bottom: 1px solid rgba(0,0,0,0.08);
  pointer-events: auto;
  max-width: 100%;
}
body[data-theme="dark"] .progress-labels{
  border-bottom: 1px solid rgba(255,255,255,0.10);
}

@media(max-width: 820px){
  .progress-labels{ gap: 8px; padding: 10px 10px; }
}

.pill{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  padding: 8px 12px;
  border-radius: 999px;
  font-size: 13px;
  font-weight: 700;
  letter-spacing: 0.01em;
  color: color-mix(in srgb, var(--brand) 92%, transparent);
  background: color-mix(in srgb, var(--brand) 7%, transparent);
  border: 1px solid color-mix(in srgb, var(--brand) 16%, transparent);
  cursor: pointer;
  transition: transform 180ms cubic-bezier(.2,.9,.2,1), background 180ms ease, border-color 180ms ease;
}

.pill:hover{
  transform: translateY(-1px);
  background: color-mix(in srgb, var(--brand) 10%, transparent);
  border-color: color-mix(in srgb, var(--brand) 22%, transparent);
}

.pill.active{
  background: color-mix(in srgb, var(--brand) 16%, transparent);
  border-color: color-mix(in srgb, var(--brand) 30%, transparent);
  color: color-mix(in srgb, var(--brand) 100%, transparent);
}

/* ================= SECTION 1 (HERO) ================= */

.hero{
  min-height:100vh;
  width:100%;
  background: var(--brand-gradient);
  display:flex;
  align-items:center;
  justify-content:center;
  padding:clamp(24px,4vw,64px);
  position:relative;
  overflow:hidden;
}

/* ✅ Background carousel + hover drift vars */
.bg-carousel{
  position:absolute;
  inset:0;
  z-index:0;
  overflow:hidden;
  --hx:0px;
  --hy:0px;
}

/* ✅ 5 images, ~4s per slide => 20s total */
.bg-slide{
  position:absolute; inset:0;
  background-size: cover;
  background-position: center;
  background-repeat:no-repeat;
  opacity:0;
  will-change: opacity, transform;
  animation: slideShow 20s infinite;
  transform: translate3d(var(--hx,0px), var(--hy,0px), 0) scale(1.02);
}

/* Your supplied images */
.bg-slide:nth-child(1){
  background-image:url("https://stingraymanufacturers.github.io/Supplierportal/1.jpg");
  animation-delay: 0s;
}
.bg-slide:nth-child(2){
  background-image:url("https://stingraymanufacturers.github.io/Supplierportal/2.jpg");
  animation-delay: 4s;
}
.bg-slide:nth-child(3){
  background-image:url("https://stingraymanufacturers.github.io/Supplierportal/3.jpg");
  animation-delay: 8s;
}
.bg-slide:nth-child(4){
  background-image:url("https://stingraymanufacturers.github.io/Supplierportal/4.jpg");
  animation-delay: 12s;
}


/* ✅ Added 5th image */
.bg-slide:nth-child(5){
  background-image:url("https://stingraymanufacturers.github.io/Supplierportal/5.jpg");
  animation-delay: 16s;
}
/* ✅ Faster fade but very smooth + slow zoom */
@keyframes slideShow{
  /* Each slide is visible for ~4s of the 20s loop (works with 0/4/8/12/16s delays) */
  0%{
    opacity:0;
    transform: translate3d(var(--hx,0px), var(--hy,0px), 0) scale(1.02);
  }
  5%{
    opacity:1; /* fade in */
    transform: translate3d(var(--hx,0px), var(--hy,0px), 0) scale(1.03);
  }
  15%{
    opacity:1; /* hold */
    transform: translate3d(var(--hx,0px), var(--hy,0px), 0) scale(1.06);
  }
  20%{
    opacity:0; /* fade out */
    transform: translate3d(var(--hx,0px), var(--hy,0px), 0) scale(1.065);
  }
  100%{
    opacity:0;
    transform: translate3d(var(--hx,0px), var(--hy,0px), 0) scale(1.02);
  }
}

7%{
    opacity:1; /* quick fade-in */
    transform: translate3d(var(--hx,0px), var(--hy,0px), 0) scale(1.03);
  }
  86%{
    opacity:1; /* hold */
    transform: translate3d(var(--hx,0px), var(--hy,0px), 0) scale(1.08);
  }
  96%{
    opacity:0; /* quick fade-out */
    transform: translate3d(var(--hx,0px), var(--hy,0px), 0) scale(1.085);
  }
  100%{
    opacity:0;
    transform: translate3d(var(--hx,0px), var(--hy,0px), 0) scale(1.02);
  }
}

/* ✅ BLACK fade overlay for BOTH themes */
.hero::before{
  content:"";
  position:absolute;
  inset:0;
  background: var(--hero-fade);
  z-index:1;
}

/* Grain overlay */
.hero::after{
  content:"";
  position:absolute;
  inset:-20%;
  z-index:2;
  opacity:0.14;
  pointer-events:none;
  background-image:
    radial-gradient(circle at 20% 30%, rgba(255,255,255,0.06), transparent 55%),
    radial-gradient(circle at 80% 20%, rgba(255,255,255,0.05), transparent 50%),
    radial-gradient(circle at 20% 80%, rgba(255,255,255,0.05), transparent 52%),
    radial-gradient(circle at 70% 70%, rgba(255,255,255,0.04), transparent 55%),
    repeating-linear-gradient(0deg, rgba(255,255,255,0.02) 0 1px, transparent 1px 2px);
  filter: blur(0.2px);
  mix-blend-mode: overlay;
}

/* ✅ Smooth blend into Section 2 (no hard edge) */
.hero-blend{
  position:absolute;
  left:0;
  right:0;
  bottom:-1px;
  height: 120px; /* subtler blend */
  pointer-events:none;
  z-index:2;
  background: linear-gradient(to bottom,
    rgba(0,0,0,0) 0%,
    color-mix(in srgb, var(--surface) 40%, transparent) 65%,
    var(--surface) 100%);
}

.content{
  width:min(1200px,100%);
  text-align:center;
  color: var(--on-dark);
  display:flex;
  align-items:center;
  justify-content:center;
  flex-direction:column;
  gap:clamp(16px,2vw,22px);
  position:relative;
  z-index:3;
}

/* Theme toggle buttons (top-right, inside hero) */
.theme-toggle{
  position:absolute;
  top: clamp(14px, 2.2vw, 22px);
  right: clamp(14px, 2.2vw, 22px);
  z-index: 4;
  display:flex;
  gap: 10px;
  pointer-events:auto;
}
.theme-btn{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap: 8px;
  padding: 10px 12px;
  border-radius: 999px;
  font-size: 13px;
  font-weight: 800;
  letter-spacing: 0.01em;
  color: rgba(255,255,255,0.92);
  background: rgba(0,0,0,0.28);
  border: 1px solid rgba(255,255,255,0.18);
  backdrop-filter: blur(10px);
  cursor:pointer;
  transition: transform 180ms cubic-bezier(.2,.9,.2,1), background 180ms ease, border-color 180ms ease;
}
.theme-btn:hover{
  transform: translateY(-1px);
  background: rgba(0,0,0,0.34);
  border-color: rgba(255,255,255,0.24);
}
.theme-btn.is-active{
  background: rgba(255,255,255,0.14);
  border-color: rgba(255,255,255,0.28);
}

/* Title */
.welcome-title{
  font-size:clamp(40px,4.8vw,80px);
  font-weight:800;
  letter-spacing:-0.03em;
  margin:0;
  opacity:0;
  transform:translateY(18px);
  transition:opacity .9s ease, transform .9s cubic-bezier(.2,.9,.2,1);
  user-select:none;
  position:relative;
}
.hero.is-ready .welcome-title{ opacity:1; transform:none; }

.word{ display:inline-block; }
@keyframes pop{
  0%{transform:scale(1);}
  40%{transform:scale(1.15);}
  70%{transform:scale(.98);}
  100%{transform:scale(1);}
}
.welcome-title.is-hovering .word{
  animation:pop .55s ease both;
  animation-delay:var(--d);
}

/* Description */
.desc{
  max-width:900px;
  margin:0 auto;
  font-size:clamp(15px,1.4vw,18px);
  line-height:1.7;
  opacity:0;
  transform:translateY(10px);
  transition:.9s ease .15s;
  color: rgba(255,255,255,0.92);
}
.hero.is-ready .desc{ opacity:1; transform:none; }

/* Scroll cue */
.scroll-cue{
  margin-top: 10px;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap: 8px;
  opacity:0;
  transform: translateY(12px);
  transition: opacity .9s ease .35s, transform .9s cubic-bezier(.2,.9,.2,1) .35s;
}
.hero.is-ready .scroll-cue{ opacity:1; transform:none; }

/* Circle tiles */
.tiles{
  margin-top:clamp(14px,2vw,18px);
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:clamp(16px,2vw,24px);
  width: min(900px, 100%);
}
@media(max-width:820px){ .tiles{ grid-template-columns:1fr; } }

.tile{
  aspect-ratio:1/1;
  border-radius:50%;
  position:relative;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap: 10px;
  background: var(--glass);
  backdrop-filter:blur(6px);
  box-shadow:0 14px 32px rgba(0,0,0,.24);
  transition:.28s cubic-bezier(.2,.9,.2,1);
  cursor:pointer;
  text-decoration:none;
  color:inherit;
  -webkit-tap-highlight-color: transparent;
  max-width: 220px;
  margin: 0 auto;
}
.tile:hover{
  transform:translateY(-10px) scale(1.06);
  box-shadow:0 30px 70px rgba(0,0,0,.35);
}
.tile::before{
  content:"";
  position:absolute;
  inset:-6px;
  border-radius:50%;
  background:conic-gradient(transparent, var(--brand), transparent 60%);
  animation:spin 2.8s linear infinite;
  z-index:-1;
}
.tile::after{
  content:"";
  position:absolute;
  inset:3px;
  background: color-mix(in srgb, var(--brand) 70%, #000000 30%);
  border-radius:50%;
  z-index:-1;
}
@keyframes spin{ to{transform:rotate(360deg);} }

.tile-label{
  font-weight:700;
  font-size:clamp(15px,1.6vw,18px);
  padding: 0 16px;
  line-height:1.2;
}

/* Icons inside circle tiles */
.tile-icon{
  width: 42px;
  height: 42px;
  display:flex;
  align-items:center;
  justify-content:center;
}
.tile-icon svg{
  width: 100%;
  height: 100%;
  stroke: #ffffff;
  stroke-width: 1.8;
  stroke-linecap: round;
  stroke-linejoin: round;
  opacity: 0.9;
  transition: transform 260ms cubic-bezier(.2,.9,.2,1), opacity 260ms ease;
}
.tile:hover .tile-icon svg{
  transform: scale(1.08);
  opacity: 1;
}

/* ================= SCROLL STORY SECTIONS ================= */

.story-section{
  height: 320vh;
  position: relative;
  background: var(--surface);
  transition: background 420ms ease;
}

.story-section.is-dark{ background: var(--brand-gradient); }

.story-sticky{
  position: sticky;
  top: 0;
  height: 100vh;
  display:flex;
  align-items:center;
  padding: clamp(28px, 4vw, 62px) clamp(12px, 4vw, 56px);
}

.story-inner{
  width: min(1600px, 100%);
  margin: 0 auto;
  display:grid;
  /* ✅ Fully responsive: allow the right column to shrink on laptop widths */
  grid-template-columns: minmax(260px, 520px) minmax(0, 1fr);
  gap: clamp(18px, 4vw, 90px);
  align-items: center;
  justify-content: start;
}

/* FLIP layout for section 3 */
.story-section.is-flipped .story-inner{
  grid-template-columns: minmax(0, 1fr) minmax(260px, 520px);
}
.story-section.is-flipped .story-right{ justify-content:flex-end; }
.story-section.is-flipped .story-left{ order: 2; }
.story-section.is-flipped .story-right{ order: 1; }

@media(max-width: 1200px){
  .story-inner{
    grid-template-columns: 1fr !important;
    gap: 22px;
  }
  .story-section.is-flipped .story-left,
  .story-section.is-flipped .story-right{
    order: initial;
    justify-content: flex-start;
  }
}

.story-left{ max-width: 520px; position: relative; }

.story-title-row{
  display:flex;
  align-items:center;
  gap: 12px;
  margin-bottom: 18px;
}

.section-badge{
  width: 34px;
  height: 34px;
  border-radius: 12px;
  display:flex;
  align-items:center;
  justify-content:center;
  background: color-mix(in srgb, var(--brand) 8%, transparent);
  border: 1px solid color-mix(in srgb, var(--brand) 14%, transparent);
}
.story-section.is-dark .section-badge{
  background: rgba(255,255,255,0.14);
  border-color: rgba(255,255,255,0.18);
}
.section-badge svg{
  width: 18px;
  height: 18px;
  stroke: color-mix(in srgb, var(--brand) 92%, transparent);
  stroke-width: 2;
  stroke-linecap: round;
  stroke-linejoin: round;
  opacity: 0.9;
}
.story-section.is-dark .section-badge svg{ stroke: rgba(255,255,255,0.92); }

.story-title{
  margin:0;
  font-size: clamp(34px, 3.4vw, 54px);
  letter-spacing:-0.02em;
  color: var(--brand);
}
.story-section.is-dark .story-title{ color: #ffffff; }

/* Rail + step text */
.step-stack{
  display:grid;
  grid-template-columns: 26px 1fr;
  gap: 14px;
  align-items:flex-start;
  margin-top: 8px;
}

.rail{
  width: 20px;
  height: 190px;
  display:flex;
  align-items:center;
  justify-content:center;
  margin-top: 2px;
}
.rail-line{
  width: 2px;
  height: 100%;
  background: color-mix(in srgb, var(--brand) 16%, transparent);
  border-radius: 999px;
  position: relative;
  overflow:hidden;
}
.story-section.is-dark .rail-line{ background: rgba(255,255,255,0.18); }

.rail-fill{
  position:absolute;
  left:0; top:0;
  width:100%;
  height: 0%;
  background: color-mix(in srgb, var(--accent) 95%, transparent);
  transition: height 420ms cubic-bezier(.2,.9,.2,1);
}
.story-section.is-dark .rail-fill{ background: rgba(255,255,255,0.9); }

.rail-dots{
  position:absolute;
  left: 50%;
  top: 0;
  transform: translateX(-50%);
  height: 100%;
  width: 20px;
  display:flex;
  flex-direction:column;
  justify-content: space-between;
  padding: 6px 0;
}
.rail-dots span{
  width: 10px;
  height: 10px;
  border-radius: 50%;
  background: color-mix(in srgb, var(--brand) 20%, transparent);
  border: 1px solid color-mix(in srgb, var(--brand) 22%, transparent);
  transition: transform 260ms cubic-bezier(.2,.9,.2,1), background 260ms ease, border-color 260ms ease;
}
.story-section.is-dark .rail-dots span{
  background: rgba(255,255,255,0.18);
  border-color: rgba(255,255,255,0.22);
}
.rail-dots span.is-on{
  background: color-mix(in srgb, var(--accent) 95%, transparent);
  border-color: color-mix(in srgb, var(--accent) 95%, transparent);
  transform: scale(1.15);
}
.story-section.is-dark .rail-dots span.is-on{
  background: rgba(255,255,255,0.92);
  border-color: rgba(255,255,255,0.92);
}

/* Panels */
.step-panels{
  position: relative;
  min-height: 150px;
}
.step-panel{
  position:absolute;
  inset:0;
  opacity:0;
  transform: translateY(10px);
  transition: opacity 360ms ease, transform 360ms cubic-bezier(.2,.9,.2,1);
  pointer-events:none;
}
.step-panel.is-active{
  opacity:1;
  transform: translateY(0);
  pointer-events:auto;
}

.step-kicker{
  font-size: 12px;
  letter-spacing: 0.18em;
  text-transform: uppercase;
  color: var(--text-muted);
  margin: 0 0 10px 0;
}
.story-section.is-dark .step-kicker{ color: var(--on-dark-muted); }

.step-copy{
  margin:0;
  font-size: clamp(18px, 1.55vw, 24px);
  line-height: 1.55;
  color: var(--text);
}
.story-section.is-dark .step-copy{ color: #ffffff; }

.story-hint{
  margin-top: 18px;
  font-size: 14px;
  color: var(--text-muted);
}
.story-section.is-dark .story-hint{ color: var(--on-dark-muted); }

/* Right image tile */
.story-right{
  width: 100%;
  display:flex;
  align-items:center;
  justify-content:flex-start;
}

.img-tile{
  width: 100%;
  max-width: 1100px;
  aspect-ratio: 16 / 9;
  border-radius: 28px;
  position: relative;
  overflow: hidden;
  box-shadow: 0 40px 110px rgba(0,0,0,0.28);
  background: color-mix(in srgb, var(--brand) 8%, transparent);
  border: 1px solid rgba(255,255,255,0.14);
}
.story-section.is-dark .img-tile{
  background: rgba(255,255,255,0.10);
  border-color: rgba(255,255,255,0.18);
}
.img-tile .img-parallax{
  position:absolute;
  inset:-16px;
  transform: translate3d(var(--px,0px), var(--py,0px), 0);
  transition: transform 120ms ease;
}
.img-layer{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  object-fit: cover;
  opacity: 0;
  transform: scale(1.02);
  transition: opacity 520ms ease, transform 900ms cubic-bezier(.2,.9,.2,1);
}
.img-layer.is-visible{
  opacity: 1;
  transform: scale(1.0);
}

/* Trust banner */
.trust-banner{
  background: color-mix(in srgb, var(--surface) 96%, #f6f8fc 4%);
  padding: clamp(28px, 4vw, 44px) clamp(18px, 5vw, 64px);
}
body[data-theme="dark"] .trust-banner{ background: #000000; }

.trust-inner{
  width: min(1100px, 100%);
  margin: 0 auto;
  display:flex;
  align-items:center;
  gap: 14px;
  color: color-mix(in srgb, var(--brand) 85%, var(--text) 15%);
}
body[data-theme="dark"] .trust-inner{ color: rgba(255,255,255,0.86); }

.trust-inner svg{
  width: 26px;
  height: 26px;
  stroke: var(--brand);
  stroke-width: 1.8;
  stroke-linecap: round;
  stroke-linejoin: round;
  flex-shrink: 0;
}


/* ================= REVEAL ON SCROLL (ALL SECTIONS) ================= */
.reveal{
  opacity: 0;
  transform: translateY(18px);
  transition: opacity 700ms ease, transform 800ms cubic-bezier(.2,.9,.2,1);
  will-change: opacity, transform;
}
.reveal.is-inview{
  opacity: 1;
  transform: translateY(0);
}

/* Trust banner slide-out from beneath last section */
.trust-banner{
  position: relative;
  overflow: hidden;
}
.trust-banner.is-slide{
  opacity: 0;
  transform: translateY(-44px);
  transition: opacity 520ms ease, transform 680ms cubic-bezier(.2,.9,.2,1);
}
.trust-banner.is-slide.is-shown{
  opacity: 1;
  transform: translateY(0);
}

/* Move trust text to right */
.trust-inner{
  justify-content: space-between;
}
.trust-inner p{
  margin: 0;
  flex: 1;
  text-align: right;
}

/* <img src="https://stingraymanufacturers.github.io/Supplierportal/stingraylogo.png" alt="Stingray" style="height:18px;width:auto;margin-right:8px;vertical-align:middle;">Contact us chip (bottom-left) */
.contact-chip{
  position: fixed;
  top: 16px;
  left: 16px;
  z-index: 120;
    opacity: 0;
  pointer-events: none;
  transform: translateY(-6px);
  transition: opacity 180ms ease, transform 220ms cubic-bezier(.2,.9,.2,1), box-shadow 220ms ease, background 220ms ease;
display:flex;
  align-items:center;
  gap: 10px;
  padding: 10px 12px;
  border-radius: 16px;
  text-decoration:none;
  color: var(--text);
  background: color-mix(in srgb, var(--surface) 86%, transparent);
  border: 1px solid color-mix(in srgb, var(--brand) 18%, transparent);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  box-shadow: 0 10px 30px rgba(0,0,0,0.10);
  cursor: pointer;
  user-select:none;
  transition: transform .18s ease, box-shadow .18s ease, border-color .18s ease;
}
body[data-theme="dark"] .contact-chip{
  color: #ffffff;
  background: rgba(0,0,0,0.44);
  border-color: rgba(255,255,255,0.16);
  box-shadow: 0 18px 60px rgba(0,0,0,0.38);
}
.contact-chip:hover{
  transform: translateY(-2px);
  box-shadow: 0 26px 80px rgba(0,0,0,0.28);
  border-color: color-mix(in srgb, var(--brand) 28%, transparent);
}
.contact-avatar{
  width: 38px;
  height: 38px;
  border-radius: 14px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight: 900;
  letter-spacing: 0.02em;
  color: #ffffff;
  background: var(--brand-gradient);
  box-shadow: inset 0 0 0 1px rgba(255,255,255,0.18);
}
.contact-meta{
  display:flex;
  flex-direction:column;
  gap: 2px;
  line-height: 1.1;
}
.contact-title{
  font-size: 13px;
  font-weight: 900;
  letter-spacing: 0.01em;
}
.contact-sub{
  display:flex;
  align-items:center;
  gap: 8px;
  font-size: 12px;
  color: var(--text-muted);
}
body[data-theme="dark"] .contact-sub{ color: rgba(255,255,255,0.78); }
.contact-sub svg{
  width: 16px;
  height: 16px;
  stroke: currentColor;
  stroke-width: 1.9;
  stroke-linecap: round;
  stroke-linejoin: round;
  opacity: 0.95;
}

/* Contact popout */
.contact-pop{
  position: fixed;
  left: 16px;
  top: 74px;
  z-index: 95;
  width: min(360px, calc(100vw - 32px));
  border-radius: 18px;
  padding: 12px;
  background: color-mix(in srgb, var(--surface) 92%, transparent);
  border: 1px solid color-mix(in srgb, var(--brand) 18%, transparent);
  backdrop-filter: blur(14px);
  box-shadow: 0 24px 80px rgba(0,0,0,0.28);
  opacity: 0;
  transform: translateY(10px) scale(0.98);
  pointer-events: none;
  transition: opacity 180ms ease, transform 220ms cubic-bezier(.2,.9,.2,1);
}
body[data-theme="dark"] .contact-pop{
  background: rgba(0,0,0,0.52);
  border-color: rgba(255,255,255,0.16);
  box-shadow: 0 24px 90px rgba(0,0,0,0.44);
}

/* Show contact controls only while the Welcome (hero) section is in view */
body.show-contact .contact-chip{
  opacity: 1;
  pointer-events: auto;
  transform: translateY(0);
}
body:not(.show-contact) .contact-pop{
  opacity: 0 !important;
  pointer-events: none !important;
  transform: translateY(10px) scale(0.98) !important;
}
.contact-pop.is-open{
  opacity: 1;
  transform: translateY(0) scale(1);
  pointer-events: auto;
}
.contact-pop h4{
  margin: 4px 6px 10px;
  font-size: 12px;
  letter-spacing: 0.08em;
  text-transform: uppercase;
  color: color-mix(in srgb, var(--text) 68%, transparent);
}
body[data-theme="dark"] .contact-pop h4{ color: rgba(255,255,255,0.74); }

.contact-list{
  display:flex;
  flex-direction: column;
  gap: 10px;
  margin: 0;
  padding: 0 4px 4px;
  list-style: none;
}
.contact-card{
  display:flex;
  align-items:flex-start;
  gap: 10px;
  padding: 10px 10px;
  border-radius: 14px;
  background: color-mix(in srgb, var(--brand) 6%, transparent);
  border: 1px solid color-mix(in srgb, var(--brand) 14%, transparent);
}
body[data-theme="dark"] .contact-card{
  background: rgba(255,255,255,0.06);
  border-color: rgba(255,255,255,0.12);
}
.contact-card .dot{
  width: 10px;
  height: 10px;
  border-radius: 999px;
  background: var(--brand-gradient);
  margin-top: 5px;
  flex: 0 0 auto;
}
.contact-card .who{
  display:flex;
  flex-direction:column;
  gap: 2px;
  min-width: 0;
}
.contact-card .name{
  font-weight: 900;
  font-size: 13px;
  line-height: 1.15;
}
.contact-card .role{
  font-size: 12px;
  color: var(--text-muted);
  line-height: 1.2;
}
body[data-theme="dark"] .contact-card .role{ color: rgba(255,255,255,0.74); }
.contact-card a{
  margin-top: 6px;
  align-self: flex-start;
  display:inline-flex;
  align-items:center;
  gap: 8px;
  padding: 7px 10px;
  border-radius: 999px;
  text-decoration:none;
  font-size: 12px;
  font-weight: 800;
  color: color-mix(in srgb, var(--brand) 92%, transparent);
  background: color-mix(in srgb, var(--brand) 10%, transparent);
  border: 1px solid color-mix(in srgb, var(--brand) 18%, transparent);
  transition: transform 180ms cubic-bezier(.2,.9,.2,1), background 180ms ease, border-color 180ms ease;
}
body[data-theme="dark"] .contact-card a{
  color: #ffffff;
  background: rgba(255,255,255,0.08);
  border-color: rgba(255,255,255,0.16);
}
.contact-card a:hover{
  transform: translateY(-1px);
  background: color-mix(in srgb, var(--brand) 14%, transparent);
  border-color: color-mix(in srgb, var(--brand) 26%, transparent);
}
.contact-card a svg{
  width: 16px;
  height: 16px;
  stroke: currentColor;
  stroke-width: 1.9;
  stroke-linecap: round;
  stroke-linejoin: round;
}

/* Footer integrity note */
.site-footer{
  padding: 34px 20px 80px;
}
.site-footer .footer-inner{
  max-width: 1120px;
  margin: 0 auto;
  border-radius: 22px;
  padding: 18px 18px;
  background: color-mix(in srgb, var(--surface) 92%, transparent);
  border: 1px solid color-mix(in srgb, var(--brand) 14%, transparent);
  backdrop-filter: blur(10px);
  display:flex;
  flex-wrap: wrap;
  gap: 10px 18px;
  align-items: center;
  justify-content: space-between;
}
body[data-theme="dark"] .site-footer .footer-inner{
  background: rgba(0,0,0,0.44);
  border-color: rgba(255,255,255,0.12);
}
.footer-left{
  font-weight: 900;
  font-size: 13px;
}
.footer-right{
  font-size: 12px;
  color: var(--text-muted);
  max-width: 760px;
  text-align: right;
}
body[data-theme="dark"] .footer-right{ color: rgba(255,255,255,0.74); }

/* Reduced motion */
@media(prefers-reduced-motion: reduce){
  *{ animation:none !important; transition:none !important; scroll-behavior:auto !important; }
  .bg-slide{ opacity:0 !important; transform:none !important; }
  .bg-slide:nth-child(1){ opacity:1 !important; }
}

/* Contact chip logo fallback + mobile behavior */
.contact-avatar{
  width:34px;
  height:34px;
  border-radius:12px;
  display:flex;
  align-items:center;
  justify-content:center;
  background: rgba(255,255,255,0.10);
  border: 1px solid rgba(255,255,255,0.18);
  overflow:hidden;
}
body[data-theme="light"] .contact-avatar{
  background: rgba(0,44,115,0.06);
  border-color: rgba(0,44,115,0.18);
}
.contact-fallback{
  width:100%;
  height:100%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:800;
  letter-spacing:0.02em;
  color: var(--text);
}
.contact-logo{
  max-height:20px;
  height:20px;
  width:auto;
  transform-origin:center;
}

/* Icon-only on smaller screens */
@media (max-width: 560px){
  .contact-chip{
    padding:10px;
    gap:0;
  }
  .contact-meta{
    display:none;
  }
}


/* Subtle logo animation when contact pop is open */
.contact-chip.open .contact-logo{
  animation: logoPulse 900ms ease-in-out;
}
.contact-chip.open{
  box-shadow: 0 18px 48px rgba(0,0,0,0.22);
}


@keyframes logoPulse{
  0%{ transform: scale(1) rotate(0deg); opacity:0.92; }
  50%{ transform: scale(1.08) rotate(-3deg); opacity:1; }
  100%{ transform: scale(1) rotate(0deg); opacity:0.98; }
}


/* ================= RESPONSIVE POLISH ================= */
@media (max-width: 640px){
  .progress{ left: 0; right: 0; }
  .progress-labels{
    flex-wrap: nowrap;
    justify-content: flex-start;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    gap: 8px;
    padding: 10px 12px;
    scroll-snap-type: x mandatory;
  }
  .progress-labels::-webkit-scrollbar{ height: 0; }
  .pill{ flex: 0 0 auto; scroll-snap-align: start; }
}

@media (max-width: 480px){
  .pill{
    padding: 7px 10px;
    font-size: 12px;
  }
  .contact-chip{
    top: 10px;
    left: 10px;
    padding: 8px 10px;
    border-radius: 14px;
  }
  .contact-sub{ display:none; }
  .contact-title{ font-size: 12px; }
}


/* Hero text styling */
.hero h1,
.hero h2,
.hero p,
.hero span,
.hero a {
    color: #ffffff !important;
    text-shadow: 0 2px 6px rgba(0,0,0,0.8);
}

</style>
</head>

<body data-theme="light">

<div class="portal-shell" id="portal">

  <!-- Progress indicator -->
  <div class="progress is-hidden" id="progress">
    <div class="progress-inner">
      <div class="progress-bar" id="progressBar"></div>
    </div>
    <div class="progress-labels" id="progressLabels" aria-label="Progress">
      <button class="pill active" type="button" data-jump="hero">Welcome</button>
      <button class="pill" type="button" data-jump="how-it-works">How it works</button>
      <button class="pill" type="button" data-jump="what-you-can-do">What you can do</button>
      <button class="pill" type="button" data-jump="how-we-share" id="pillShare">Document sharing</button>
    </div>
  </div>

  <!-- ================= SECTION 1 ================= -->
  <section class="hero" id="hero">
    <div class="bg-carousel" aria-hidden="true">
            <div class="bg-slide"></div>
      <div class="bg-slide"></div>
      <div class="bg-slide"></div>
      <div class="bg-slide"></div>
      <div class="bg-slide"></div>
    </div>

    <!-- Theme toggles -->
    <div class="theme-toggle" aria-label="Theme">
      <button class="theme-btn is-active" id="btnLight" type="button" aria-pressed="true">Light</button>
      <button class="theme-btn" id="btnDark" type="button" aria-pressed="false">Dark</button>
    </div>

    <div class="content">
      <h1 class="welcome-title" id="welcomeTitle">
        <span id="words"></span>
      </h1>

      <p class="desc">
        This portal is your single place to work with us, without the back and forth.
        Use it to access documents, updates, and the info you need to supply confidently.
        Track what matters, respond faster, and keep everything in one clear thread.
      </p>

      <div class="tiles" aria-label="Landing tiles">
        <a class="tile" href="#how-it-works" data-scroll="how-it-works" aria-label="How it works">
          <div class="tile-icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none">
              <path d="M5 12h14M13 5l6 7-6 7"/>
            </svg>
          </div>
          <div class="tile-label">How it works</div>
        </a>

        <a class="tile" href="#what-you-can-do" data-scroll="what-you-can-do" aria-label="What you can do">
          <div class="tile-icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none">
              <path d="M9 6h11M9 12h11M9 18h11M4 6l1.5 1.5L8 5M4 12l1.5 1.5L8 11M4 18l1.5 1.5L8 17"/>
            </svg>
          </div>
          <div class="tile-label">What you can do</div>
        </a>

        <a class="tile" href="#how-we-share" data-scroll="how-we-share" aria-label="Document sharing">
          <div class="tile-icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none">
              <path d="M7 3h7l3 3v15H7V3z"/>
              <path d="M14 3v4h4"/>
              <path d="M9 12h6M9 16h6"/>
            </svg>
          </div>
          <div class="tile-label">Document sharing</div>
        </a>
      </div>

      <div class="scroll-cue" aria-hidden="true" style="margin-top:10px; opacity:.9;">
        <div style="font-size:12px; letter-spacing:.18em; text-transform:uppercase; color:rgba(255,255,255,0.78);">Scroll</div>
      </div>
    </div>

    <div class="hero-blend" aria-hidden="true"></div>
  </section>

  <!-- ================= SECTION 2 ================= -->
  <section class="story-section reveal" id="how-it-works" data-story>
    <div class="story-sticky">
      <div class="story-inner">
        <div class="story-left">

          <div class="story-title-row">
            <div class="section-badge" aria-hidden="true">
              <svg viewBox="0 0 24 24" fill="none">
                <path d="M5 12h14M13 5l6 7-6 7"/>
              </svg>
            </div>
            <h2 class="story-title">How it works</h2>
          </div>

          <div class="step-stack">
            <div class="rail" aria-hidden="true">
              <div class="rail-line">
                <div class="rail-fill" data-railfill></div>
                <div class="rail-dots">
                  <span data-dot="0" class="is-on"></span>
                  <span data-dot="1"></span>
                  <span data-dot="2"></span>
                </div>
              </div>
            </div>

            <div class="step-panels" aria-live="polite">
              <div class="step-panel is-active" data-panel="0">
                <div class="step-kicker">Step 1</div>
                <p class="step-copy">Start here to see the latest updates and what is currently needed from you.</p>
              </div>
              <div class="step-panel" data-panel="1">
                <div class="step-kicker">Step 2</div>
                <p class="step-copy">When something changes, it is reflected in one place so you are not chasing threads.</p>
              </div>
              <div class="step-panel" data-panel="2">
                <div class="step-kicker">Step 3</div>
                <p class="step-copy">Follow the steps, confirm details, and keep the process moving with less back and forth.</p>
              </div>
            </div>
          </div>

          <div class="story-hint">Scroll to move between steps.</div>
        </div>

        <div class="story-right">
          <div class="img-tile" data-imgtile="how-it-works" aria-label="How it works image">
            <div class="img-parallax">
              <img class="img-layer is-visible" data-layer="a" alt="How it works visual A" />
              <img class="img-layer" data-layer="b" alt="How it works visual B" />
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="hero-blend" aria-hidden="true"></div>
  </section>

  <!-- ================= SECTION 3 (FLIPPED) ================= -->
  <section class="story-section reveal is-flipped" id="what-you-can-do" data-story>
    <div class="story-sticky">
      <div class="story-inner">
        <div class="story-left">

          <div class="story-title-row">
            <div class="section-badge" aria-hidden="true">
              <svg viewBox="0 0 24 24" fill="none">
                <path d="M9 6h11M9 12h11M9 18h11M4 6l1.5 1.5L8 5M4 12l1.5 1.5L8 11M4 18l1.5 1.5L8 17"/>
              </svg>
            </div>
            <h2 class="story-title">What you can do</h2>
          </div>

          <div class="step-stack">
            <div class="rail" aria-hidden="true">
              <div class="rail-line">
                <div class="rail-fill" data-railfill></div>
                <div class="rail-dots">
                  <span data-dot="0" class="is-on"></span>
                  <span data-dot="1"></span>
                  <span data-dot="2"></span>
                </div>
              </div>
            </div>

            <div class="step-panels" aria-live="polite">
              <div class="step-panel is-active" data-panel="0">
                <div class="step-kicker">Step 1</div>
                <p class="step-copy">Get a clear view of what is required, without digging through emails.</p>
              </div>
              <div class="step-panel" data-panel="1">
                <div class="step-kicker">Step 2</div>
                <p class="step-copy">Confirm details quickly, share what we need from you, and keep things moving.</p>
              </div>
              <div class="step-panel" data-panel="2">
                <div class="step-kicker">Step 3</div>
                <p class="step-copy">Stay aligned with updates as they happen, so you can deliver with confidence.</p>
              </div>
            </div>
          </div>

          <div class="story-hint">Scroll to move between steps.</div>
        </div>

        <div class="story-right">
          <div class="img-tile" data-imgtile="what-you-can-do" aria-label="What you can do image">
            <div class="img-parallax">
              <img class="img-layer is-visible" data-layer="a" alt="What you can do visual A" />
              <img class="img-layer" data-layer="b" alt="What you can do visual B" />
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="hero-blend" aria-hidden="true"></div>
  </section>

  <!-- ================= SECTION 4 (REPLACED) ================= -->
  <section class="story-section reveal" id="how-we-share" data-story>
    <div class="story-sticky">
      <div class="story-inner">
        <div class="story-left">

          <div class="story-title-row">
            <div class="section-badge" aria-hidden="true">
              <svg viewBox="0 0 24 24" fill="none">
                <path d="M7 3h7l3 3v15H7V3z"/>
                <path d="M14 3v4h4"/>
                <path d="M9 12h6M9 16h6"/>
              </svg>
            </div>
            <h2 class="story-title">Document sharing</h2>
          </div>

          <div class="step-stack">
            <div class="rail" aria-hidden="true">
              <div class="rail-line">
                <div class="rail-fill" data-railfill></div>
                <div class="rail-dots">
                  <span data-dot="0" class="is-on"></span>
                  <span data-dot="1"></span>
                  <span data-dot="2"></span>
                </div>
              </div>
            </div>

            <div class="step-panels" aria-live="polite">
              <div class="step-panel is-active" data-panel="0">
                <div class="step-kicker">Step 1</div>
                <p class="step-copy">Use your supplier folder to upload and store key documents in one place.</p>
              </div>
              <div class="step-panel" data-panel="1">
                <div class="step-kicker">Step 2</div>
                <p class="step-copy">Keep files named clearly so everyone can find the latest version quickly.</p>
              </div>
              <div class="step-panel" data-panel="2">
                <div class="step-kicker">Step 3</div>
                <p class="step-copy">Use the library as the single source of truth for forms, specs, and supporting files.</p>
              </div>
            </div>
          </div>

          <div class="story-hint">Scroll to move between steps.</div>
        </div>

        <div class="story-right">
          <div class="img-tile" data-imgtile="how-we-share" aria-label="Document sharing image">
            <div class="img-parallax">
              <img class="img-layer is-visible" data-layer="a" alt="Document sharing visual A" />
              <img class="img-layer" data-layer="b" alt="Document sharing visual B" />
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="hero-blend" aria-hidden="true"></div>
  </section>

  <!-- Trust banner -->
  <section class="trust-banner reveal is-slide">
    <div class="trust-inner">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
        <path d="M12 3l7 4v5c0 4.4-3 8.3-7 9-4-.7-7-4.6-7-9V7l7-4z"/>
        <path d="M9 12l2 2 4-4"/>
      </svg>
      <p>Your information is handled securely and shared only with the teams involved in your supply process.</p>
    </div>

    <div class="hero-blend" aria-hidden="true"></div>
  </section>

    <!-- Site footer -->
  <footer class="site-footer reveal" id="siteFooter">
    <div class="footer-inner">
      <div class="footer-left">Designed by Luke Vella</div>
      <div class="footer-right">This portal is built to protect the integrity of your submissions. Data is handled responsibly and shared only with authorised internal teams involved in your supply process.</div>
    </div>
  </footer>

  <!-- Contact us popout -->
  <div class="contact-pop" id="contactPop" role="dialog" aria-label="Contact list" aria-hidden="true">
    <h4>Contact us</h4>
    <ul class="contact-list">
      <li class="contact-card">
        <span class="dot" aria-hidden="true"></span>
        <div class="who">
          <div class="name">Kim Green</div>
          <div class="role">Admin Manager</div>
          <a href="mailto:kim@stingray.co.za" aria-label="Email Kim Green">
            <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M4 6h16v12H4V6z"/>
              <path d="M4 7l8 6 8-6"/>
            </svg>
            <span>Email</span>
          </a>
        </div>
      </li>

      <li class="contact-card">
        <span class="dot" aria-hidden="true"></span>
        <div class="who">
          <div class="name">Tatum Eybers</div>
          <div class="role">Shipping &amp; Supply Chain Manager</div>
          <a href="mailto:tatum.eybers@stingray.co.za" aria-label="Email Tatum Eybers">
            <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M4 6h16v12H4V6z"/>
              <path d="M4 7l8 6 8-6"/>
            </svg>
            <span>Email</span>
          </a>
        </div>
      </li>

      <li class="contact-card">
        <span class="dot" aria-hidden="true"></span>
        <div class="who">
          <div class="name">Evan Coetzee</div>
          <div class="role">Art Department Manager</div>
          <a href="mailto:evan.coetzee@stingray.co.za" aria-label="Email Evan Coetzee">
            <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M4 6h16v12H4V6z"/>
              <path d="M4 7l8 6 8-6"/>
            </svg>
            <span>Email</span>
          </a>
        </div>
      </li>
    </ul>
  </div>

  <!-- Contact us chip -->
  <button class="contact-chip" id="contactChip" type="button" aria-label="Open contact list" aria-expanded="false">
    <div class="contact-avatar" aria-hidden="true">
      <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
        <path d="M4 6h16v12H4V6z"/>
        <path d="M4 7l8 6 8-6"/>
      </svg>
    </div>
    <div class="contact-meta">
      <div class="contact-title">Contact us</div>
      <div class="contact-sub">
        <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M4 6h16v12H4V6z"/>
          <path d="M4 7l8 6 8-6"/>
        </svg>
        <span>Email</span>
      </div>
    </div>
  </button>

</div>

<script>
const portal = document.getElementById("portal");
const progress = document.getElementById("progress");
const progressLabels = document.getElementById("progressLabels");
const progressBar = document.getElementById("progressBar");

/* ✅ Theme toggle */
const btnLight = document.getElementById("btnLight");
const btnDark  = document.getElementById("btnDark");

function setTheme(theme){
  document.body.setAttribute("data-theme", theme);
  localStorage.setItem("stingrayTheme", theme);

  const isLight = theme === "light";
  btnLight.classList.toggle("is-active", isLight);
  btnDark.classList.toggle("is-active", !isLight);
  btnLight.setAttribute("aria-pressed", String(isLight));
  btnDark.setAttribute("aria-pressed", String(!isLight));
}

btnLight.addEventListener("click", ()=>setTheme("light"));
btnDark.addEventListener("click", ()=>setTheme("dark"));

const savedTheme = localStorage.getItem("stingrayTheme");
setTheme(savedTheme === "dark" ? "dark" : "light");

/* ✅ Contact us popout */
const contactChip = document.getElementById("contactChip");
const contactPop  = document.getElementById("contactPop");

function setContactOpen(isOpen){
  contactPop.classList.toggle("is-open", isOpen);
  contactPop.setAttribute("aria-hidden", String(!isOpen));
  contactChip.setAttribute("aria-expanded", String(isOpen));
  contactChip.classList.toggle("open", isOpen);
}

contactChip.addEventListener("click", (e)=>{
  e.stopPropagation();
  const open = contactPop.classList.contains("is-open");
  setContactOpen(!open);
});

document.addEventListener("click", (e)=>{
  if(!contactPop.classList.contains("is-open")) return;
  const inside = contactPop.contains(e.target) || contactChip.contains(e.target);
  if(!inside) setContactOpen(false);
});

document.addEventListener("keydown", (e)=>{
  if(e.key === "Escape") setContactOpen(false);
});


/* Show the contact chip only while the Welcome section is visible */
(function(){
  const rootScroller = portal || null; // portal is the scroll container
  const heroSection = document.getElementById("hero");
  if(!heroSection) return;

  const io = new IntersectionObserver((entries)=>{
    entries.forEach((entry)=>{
      if(entry.isIntersecting){
        document.body.classList.add("show-contact");
      } else {
        document.body.classList.remove("show-contact");
        setContactOpen(false);
      }
    });
  }, { root: rootScroller, threshold: 0.35 });

  io.observe(heroSection);
})();


/* Title word animation */
const titleText="Welcome to the Stingray Supplier Portal";
const wordsEl=document.getElementById("words");
const titleEl=document.getElementById("welcomeTitle");
const hero=document.getElementById("hero");

titleText.split(" ").forEach((w,i)=>{
  const s=document.createElement("span");
  s.className="word";
  s.textContent=w;
  s.style.setProperty("--d",`${i*60}ms`);
  wordsEl.appendChild(s);
  wordsEl.append(" ");
});

window.addEventListener("load",()=>hero.classList.add("is-ready"));

titleEl.addEventListener("mouseenter",()=>{
  titleEl.classList.remove("is-hovering");
  void titleEl.offsetWidth;
  titleEl.classList.add("is-hovering");
});

/* Smooth scroll inside portal container */
function scrollToInPortal(targetEl){
  const portalTop = portal.getBoundingClientRect().top;
  const targetTop = targetEl.getBoundingClientRect().top;
  const offset = (targetTop - portalTop) + portal.scrollTop;
  portal.scrollTo({ top: offset, behavior: "smooth" });
}

/* Tile clicks */
document.querySelectorAll("[data-scroll]").forEach(link=>{
  link.addEventListener("click",(e)=>{
    const id = link.getAttribute("data-scroll");
    const target = document.getElementById(id);
    if(!target) return;
    e.preventDefault();
    scrollToInPortal(target);
  });
});

/* Section map */
const sectionMap = {
  hero: document.getElementById("hero"),
  "how-it-works": document.getElementById("how-it-works"),
  "what-you-can-do": document.getElementById("what-you-can-do"),
  "how-we-share": document.getElementById("how-we-share")
};

/* Update pill target map */
document.querySelectorAll(".pill").forEach(p=>{
  p.addEventListener("click", ()=>{
    const key = p.getAttribute("data-jump");
    const target = sectionMap[key];
    if(target) scrollToInPortal(target);
  });
});

/* ✅ Subtle hover drift on HERO carousel (slow + not drastic) */
(function bindHeroCarouselDrift(){
  const reduceMotion = window.matchMedia && window.matchMedia("(prefers-reduced-motion: reduce)").matches;
  if(reduceMotion) return;

  const heroEl = document.getElementById("hero");
  const bgCarousel = heroEl.querySelector(".bg-carousel");

  let targetX = 0, targetY = 0;
  let currentX = 0, currentY = 0;
  let rafId = null;

  function animate(){
    currentX += (targetX - currentX) * 0.05;
    currentY += (targetY - currentY) * 0.05;

    bgCarousel.style.setProperty("--hx", currentX.toFixed(2) + "px");
    bgCarousel.style.setProperty("--hy", currentY.toFixed(2) + "px");

    rafId = requestAnimationFrame(animate);
  }

  heroEl.addEventListener("mouseenter", ()=>{
    if(!rafId) rafId = requestAnimationFrame(animate);
  });

  heroEl.addEventListener("mousemove", (e)=>{
    const r = heroEl.getBoundingClientRect();
    const dx = (e.clientX - (r.left + r.width/2)) / r.width;
    const dy = (e.clientY - (r.top + r.height/2)) / r.height;

    const max = 10; // subtle
    targetX = Math.max(-max, Math.min(max, dx * max));
    targetY = Math.max(-max, Math.min(max, dy * max));
  });

  heroEl.addEventListener("mouseleave", ()=>{
    targetX = 0; targetY = 0;
    setTimeout(()=>{
      if(Math.abs(currentX) < 0.25 && Math.abs(currentY) < 0.25){
        cancelAnimationFrame(rafId);
        rafId = null;
        currentX = 0; currentY = 0;
        bgCarousel.style.setProperty("--hx", "0px");
        bgCarousel.style.setProperty("--hy", "0px");
      }
    }, 650);
  });
})();

/* Image sets (add for new section id) */
const stepImages = {
  "how-it-works": [
    "https://images.unsplash.com/photo-1553877522-43269d4ea984?auto=format&fit=crop&w=2000&q=70",
    "https://images.unsplash.com/photo-1551434678-e076c223a692?auto=format&fit=crop&w=2000&q=70",
    "https://images.unsplash.com/photo-1552664730-d307ca884978?auto=format&fit=crop&w=2000&q=70"
  ],
  "what-you-can-do": [
    "https://images.unsplash.com/photo-1556761175-4b46a572b786?auto=format&fit=crop&w=2000&q=70",
    "https://images.unsplash.com/photo-1521737604893-d14cc237f11d?auto=format&fit=crop&w=2000&q=70",
    "https://images.unsplash.com/photo-1523958203904-cdcb402031fd?auto=format&fit=crop&w=2000&q=70"
  ],
  "how-we-share": [
    "https://images.unsplash.com/photo-1456324504439-367cee3b3c32?auto=format&fit=crop&w=2000&q=70",
    "https://images.unsplash.com/photo-1520607162513-77705c0f0d4a?auto=format&fit=crop&w=2000&q=70",
    "https://images.unsplash.com/photo-1568992687947-868a62a9f521?auto=format&fit=crop&w=2000&q=70"
  ]
};

/* Crossfade per tile */
function setTileImage(tileKey, stepIdx){
  const tile = document.querySelector(`[data-imgtile="${tileKey}"]`);
  if(!tile) return;

  const imgs = stepImages[tileKey] || [];
  const url = imgs[stepIdx] || imgs[0] || "";

  const currentUrl = tile.getAttribute("data-current-url");
  if(currentUrl === url) return;

  const layerA = tile.querySelector('[data-layer="a"]');
  const layerB = tile.querySelector('[data-layer="b"]');
  const showing = tile.getAttribute("data-showing") || "a";
  const next = (showing === "a") ? "b" : "a";
  const nextEl = (next === "a") ? layerA : layerB;
  const curEl = (showing === "a") ? layerA : layerB;

  nextEl.src = url;
  nextEl.onload = () => {
    nextEl.onload = null;
    nextEl.classList.add("is-visible");
    curEl.classList.remove("is-visible");
    tile.setAttribute("data-showing", next);
    tile.setAttribute("data-current-url", url);
  };
}

/* Update step rail and show only active panel */
function setStepUI(section, idx){
  const fill = section.querySelector("[data-railfill]");
  const dots = Array.from(section.querySelectorAll(".rail-dots span"));
  if(fill){
    const pct = idx === 0 ? 12 : idx === 1 ? 56 : 100;
    fill.style.height = pct + "%";
  }
  dots.forEach(d => d.classList.toggle("is-on", Number(d.getAttribute("data-dot")) <= idx));

  const panels = Array.from(section.querySelectorAll(".step-panel"));
  panels.forEach(p => p.classList.toggle("is-active", Number(p.getAttribute("data-panel")) === idx));
}

/* Scrollytelling + progress */
(function(){
  const storySections = Array.from(document.querySelectorAll("[data-story]"));
  if(storySections.length === 0) return;

  function setActiveStep(section, idx){
    section.classList.toggle("is-dark", idx === 1);
    setStepUI(section, idx);
    setTileImage(section.id, idx);
  }

  function setActivePill(key){
    document.querySelectorAll(".pill").forEach(p =>
      p.classList.toggle("active", p.getAttribute("data-jump") === key)
    );
  }

  function overallProgress(){
    const maxScroll = portal.scrollHeight - portal.clientHeight;
    const p = maxScroll <= 0 ? 0 : (portal.scrollTop / maxScroll);
    progressBar.style.width = (p * 100).toFixed(2) + "%";
  }

  function activeSectionKey(){
    const y = portal.scrollTop + (portal.clientHeight * 0.35);
    const entries = Object.entries(sectionMap)
      .map(([k, el]) => [k, el.offsetTop])
      .sort((a,b)=>a[1]-b[1]);

    let current = "hero";
    for(const [k, top] of entries){
      if(top <= y) current = k;
      else break;
    }
    setActivePill(current);
    return current;
  }

  function toggleProgressVisibility(){
    const threshold = sectionMap["how-it-works"].offsetTop - 10;
    const show = portal.scrollTop >= threshold;
    progress.classList.toggle("is-visible", show);
    progress.classList.toggle("is-hidden", !show);
    progressLabels.style.display = show ? "flex" : "none";
  }

  function onPortalScroll(){
    const vh = portal.clientHeight;

    storySections.forEach(section=>{
      const sectionTop = section.offsetTop;
      const sectionHeight = section.offsetHeight;
      const total = sectionHeight - vh;
      if(total <= 0) return;

      const scrolled = Math.min(Math.max(portal.scrollTop - sectionTop, 0), total);
      const p = scrolled / total;
      const idx = Math.min(2, Math.floor(p * 3));
      setActiveStep(section, idx);
    });

    overallProgress();
    activeSectionKey();
    toggleProgressVisibility();
  }

  Object.keys(stepImages).forEach(k => setTileImage(k, 0));
  storySections.forEach(sec => { setStepUI(sec,0); sec.classList.remove("is-dark"); });

  portal.addEventListener("scroll", onPortalScroll, { passive: true });
  window.addEventListener("resize", onPortalScroll);
  onPortalScroll();
})();

/* ✅ Reveal sections on scroll (fade-in) */
(function(){
  const targets = Array.from(document.querySelectorAll(".reveal"));
  if(targets.length === 0) return;

  const reduceMotion = window.matchMedia && window.matchMedia("(prefers-reduced-motion: reduce)").matches;
  if(reduceMotion){
    targets.forEach(el => el.classList.add("is-inview"));
    return;
  }

  const io = new IntersectionObserver((entries)=>{
    entries.forEach(entry=>{
      if(entry.isIntersecting){
        entry.target.classList.add("is-inview");
        io.unobserve(entry.target);
      }
    });
  }, { root: portal, threshold: 0.12 });

  targets.forEach(el => io.observe(el));
})();

/* ✅ Trust banner slides out from beneath the last section */
(function(){
  const lastSection = document.getElementById("how-we-share");
  const trustBanner = document.querySelector(".trust-banner.is-slide");
  if(!lastSection || !trustBanner) return;

  const reduceMotion = window.matchMedia && window.matchMedia("(prefers-reduced-motion: reduce)").matches;
  if(reduceMotion){
    trustBanner.classList.add("is-shown");
    return;
  }

  const io = new IntersectionObserver((entries)=>{
    entries.forEach(entry=>{
      if(entry.isIntersecting){
        trustBanner.classList.add("is-shown");
        io.disconnect();
      }
    });
  }, { root: portal, threshold: 0.55 });

  io.observe(lastSection);
})();

</script>

</body>
</html>